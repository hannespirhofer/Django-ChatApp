{% extends "base.html" %}
{% block content %}
<p>Please register to join the chatroom or <a href="/login">log in here</a></p>
<form action="{% url 'register' %}" method="post">
{% csrf_token %}
<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
    <input
    class="mdl-textfield__input"
    name="username"
    id="username"
    type="text"
    />
    <label class="mdl-textfield__label" for="sample3">Username</label>
</div>
<br>
<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
    <input
    class="mdl-textfield__input"
    name="firstname"
    id="firstname"
    type="text"
    />
    <label class="mdl-textfield__label" for="sample3">Firstname</label>
</div>
<br>
<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
    <input
    class="mdl-textfield__input"
    name="password"
    id="password"
    type="password"
    />
    <label class="mdl-textfield__label" for="sample3">Password</label>
</div><br>
<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
    <input
    class="mdl-textfield__input"
    name="password"
    id="password_repeat"
    type="password"
    />
    <label class="mdl-textfield__label" for="sample3">Repeat Password</label>
</div><br>
<div id="password_match_msg"></div>
<button
    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"
    id="register"
    type="submit"
    >
    Register
</button>
{% if error_message %}
    {{ error_message }}
{% endif %}
</form>

{% block extra_scripts %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const usernameField = document.getElementById("username");
        const firstnameField = document.getElementById("firstname");
        const passwordField = document.getElementById("password");
        const passwordRepeatField = document.getElementById("password_repeat");
        const passwordMatchMessage = document.getElementById("password_match_msg");
        const registerButton = document.getElementById("register");
        passwordMatchMessage.innerHTML = "";

        function toggleButtonState() {
            if (usernameField.value.trim() && firstnameField.value.trim() && passwordField.value.trim() && passwordRepeatField.value.trim()) {
                if (passwordField.value.trim() === passwordRepeatField.value.trim()) {
                    registerButton.disabled = false;
                }
            } else {
                registerButton.disabled = true;
            }
        }

        function onCheckPassword() {
            const password = passwordField.value.trim();
            const passwordRepeat = passwordRepeatField.value.trim();

            if (password && passwordRepeat) {
                if (password === passwordRepeat) {
                    passwordMatchMessage.innerHTML = "";
                } else {
                    passwordMatchMessage.innerHTML = "Passwords must match.";
                }
            } else {
                passwordMatchMessage.innerHTML = "";
            }
        }

        function onUsernameInput() {
            let username = usernameField.value.trim();
            usernameField.value = username.toLowerCase();
        }

        usernameField.addEventListener("input", toggleButtonState);
        usernameField.addEventListener("input", onUsernameInput);
        firstnameField.addEventListener("input", toggleButtonState);
        passwordRepeatField.addEventListener("input", toggleButtonState);
        passwordField.addEventListener("input", toggleButtonState);

        passwordRepeatField.addEventListener("input", onCheckPassword);

        //Initial check in case there are prefilled values from the browser
        toggleButtonState();
    });
</script>
{% endblock %}
{% endblock %}